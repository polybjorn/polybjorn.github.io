---
import '@fontsource/piazzolla/400.css';
import '@fontsource/piazzolla/700.css';
import '@fontsource/piazzolla/400-italic.css';
const { lang = 'en', title, description, image } = Astro.props;
const otherLang = lang === 'en' ? 'no' : 'en';
const otherUrl = lang === 'en' ? '/no' : '/';
const path = Astro.url.pathname;
const canonicalUrl = `https://polybjorn.com${path === '/' ? '' : path}`;
const ogImage = image ?? 'https://res.cloudinary.com/det9ftymo/image/upload/c_pad,b_rgb:1e2228,w_1200,h_630/v1725405810/photo_jn86fv.jpg';
---
<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" hreflang="en" href="https://polybjorn.com" />
    <link rel="alternate" hreflang="no" href="https://polybjorn.com/no" />
    <link rel="alternate" hreflang="x-default" href="https://polybjorn.com" />
    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <!-- Twitter/X Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <!-- JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify([{
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Bjørn A. Andersen",
      "alternateName": "Bjørn Andreas Andersen",
      "url": "https://polybjorn.com",
      "image": "https://res.cloudinary.com/det9ftymo/image/upload/c_pad,b_gen_fill,w_360,h_360/v1725405810/photo_jn86fv.jpg",
      "sameAs": [
        "https://grabcad.com/bjorn.a.andersen-1",
        "https://social.polybjorn.com/@bjanda"
      ],
      "jobTitle": "3D Designer & Instructor",
      "description": "3D modelling, additive manufacturing, graphic design, and hands-on 3D printing courses.",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Haugesund",
        "addressCountry": "NO"
      },
      "knowsAbout": ["3D modelling", "3D printing", "Additive manufacturing", "Graphic design"]
    }, {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "3D Printing Courses",
      "description": "Hands-on courses in 3D printing and design.",
      "areaServed": "NO",
      "provider": {
        "@type": "Person",
        "name": "Bjørn A. Andersen",
        "url": "https://polybjorn.com"
      }
    }])} />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css" />
    <slot name="head" />
    <style>
      .lang-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        text-decoration: none;
        z-index: 100;
        opacity: 0.75;
        transition: opacity 0.3s, transform 0.3s;
        line-height: 1;
      }
      .lang-toggle:hover { opacity: 1; }
      .lang-toggle.hidden {
        opacity: 0;
        pointer-events: none;
        transform: translateY(-0.5rem);
      }
      .lang-toggle .fi {
        width: 1.75rem;
        height: 1.25rem;
        border-radius: 4px;
        display: block;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <a class="lang-toggle" href={otherUrl} title={otherLang === 'no' ? 'Norsk' : 'English'}>
      <span class={`fi fi-${otherLang === 'no' ? 'no' : 'eu'}`}></span>
    </a>
    <slot />
    <script define:vars={{ lang }}>
      if (lang === 'en' && !localStorage.getItem('lang')) {
        if (navigator.language.startsWith('no')) {
          localStorage.setItem('lang', 'no');
          window.location.replace('/no');
        }
      }
      document.querySelector('.lang-toggle').addEventListener('click', () => {
        localStorage.setItem('lang', {lang} === 'en' ? 'no' : 'en');
      });

      const flag = document.querySelector('.lang-toggle');
      window.addEventListener('scroll', () => {
        flag.classList.toggle('hidden', window.scrollY > 60);
      }, { passive: true });
    </script>
  </body>
</html>